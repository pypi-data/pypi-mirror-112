(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[23],{120:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return j})),n.d(t,"i",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"h",(function(){return m})),n.d(t,"g",(function(){return x})),n.d(t,"j",(function(){return g}));var c=n(18),i=n(0),r=n(2),o=(n(3),n(39),function(e,t){if(e.min<=t&&t<e.max)return e;var n=e.max-e.min,c=Math.max(0,Math.floor(t-n/2));return{min:c,max:c+n}}),a=function(e,t){if("SetRecordingSelection"===t.type)return Object(r.a)({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object(r.a)(Object(r.a)({},e),{},{selectedElectrodeIds:t.selectedElectrodeIds.filter((function(t){return!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)}))});if("SetVisibleElectrodeIds"===t.type)return Object(r.a)(Object(r.a)({},e),{},{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((function(e){return t.visibleElectrodeIds.includes(e)})):void 0});if("SetCurrentTimepoint"===t.type)return Object(r.a)(Object(r.a)({},e),{},{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?o(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object(r.a)(Object(r.a)({},e),{},{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){var n,c,i=e.currentTimepoint,a=e.timeRange;if(!a)return e;var l,u=null!==(n=t.direction)&&void 0!==n?n:"in",d=null!==(c=t.factor)&&void 0!==c?c:1.4,b="out"===u?1/d:d;if((a.max-a.min)/b>9e6)return e;l=void 0===i||i<a.min?a.min:i>a.max?a.max:i;var j=s(a,b,l);return Object(r.a)(Object(r.a)({},e),{},{timeRange:j})}if("SetAmpScaleFactor"===t.type)return Object(r.a)(Object(r.a)({},e),{},{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){var f,O,p=null!==(f=t.direction)&&void 0!==f?f:"up",h=null!==(O=t.multiplier)&&void 0!==O?O:1.4,m="down"===p?1/h:h;return Object(r.a)(Object(r.a)({},e),{},{ampScaleFactor:(e.ampScaleFactor||1)*m})}return"SetCurrentTimepointVelocity"===t.type?Object(r.a)(Object(r.a)({},e),{},{animation:Object(r.a)(Object(r.a)({},e.animation||{}),{},{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object(r.a)(Object(r.a)({},e),{},{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},s=function(e,t,n){var c=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(c),max:Math.floor(i)}},l=n(10),u=function(e,t){return((t||{}).mergeGroups||[]).filter((function(t){return t.includes(e)}))[0]||null},d=function(e,t,n){return n&&u(e,t)||e},b=function(e,t){var n=u(e,t);return!n||Math.min.apply(Math,Object(l.a)(n))===e},j=function(e,t){return"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object(r.a)(Object(r.a)({},e),{},{selectedUnitIds:t.selectedUnitIds.filter((function(t){var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object(r.a)(Object(r.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?function(e,t){var n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object(r.a)(Object(r.a)({},e),{},{selectedUnitIds:(e.selectedUnitIds||[]).filter((function(e){return e!==n}))}):Object(r.a)(Object(r.a)({},e),{},{selectedUnitIds:[].concat(Object(l.a)(e.selectedUnitIds||[]),[n])}):Object(r.a)(Object(r.a)({},e),{},{selectedUnitIds:[n]})}(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?f(Object(r.a)(Object(r.a)({},e),{},{applyMerges:!e.applyMerges}),t.curation):a(e,t)},f=function(e,t){return e.applyMerges&&t?Object(r.a)(Object(r.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){return b(e,t)})):void 0}):e},O=function(e){return e.filter((function(e){return!e.disabled&&!e.development}))},p=function(e){return O(e).filter((function(e){return"SortingView"===e.type})).map((function(e){return e}))},h=function(e){return O(e).filter((function(e){return"RecordingView"===e.type})).map((function(e){return e}))},m=function(e){return O(e).filter((function(e){return"SortingUnitView"===e.type})).map((function(e){return e}))},x=function(e){return O(e).filter((function(e){return"SortingUnitMetric"===e.type})).map((function(e){return e}))},g=function(){var e=Object(c.g)();return Object(i.useMemo)((function(){return e.filter((function(e){return"WorkspaceView"===e.type})).map((function(e){return e}))}),[e])}},161:function(e,t,n){"use strict";var c=n(13);n(0);t.a=function(e){var t=e.color,n=e.onClick,i=e.children,r={color:t||"gray",cursor:"pointer",textDecoration:"underline"};return Object(c.jsx)("span",{style:r,onClick:n,children:i})}},247:function(e,t,n){"use strict";var c=n(13),i=n(9),r=n(198),o=n(199),a=n(201),s=n(202),l=n(200),u=n(253),d=n(195),b=n(637),j=n(638),f=n(0),O=(n(261),function(e){var t=e.title,n=e.rowKey,i=e.onDeleteRow,r=Object(f.useCallback)((function(){i&&i(n)}),[i,n]);return Object(c.jsx)(d.a,{title:t,onClick:r,children:Object(c.jsx)(b.a,{})})}),p=function(e){var t=e.title,n=e.rowKey,i=e.onConfirmDeleteRow,r=Object(f.useCallback)((function(){i&&i(n,!0)}),[i,n]),o=Object(f.useCallback)((function(){i&&i(n,!1)}),[i,n]);return Object(c.jsxs)("span",{children:["Confirm delete?",Object(c.jsx)(d.a,{title:t,onClick:r,children:Object(c.jsx)(b.a,{})}),Object(c.jsx)(d.a,{title:"Cancel",onClick:o,children:"\u2716"})]})},h=function(e){var t=e.title,n=e.rowKey,i=e.onEditRow;return Object(c.jsx)(d.a,{title:t,onClick:function(){return i&&i(n)},children:Object(c.jsx)(j.a,{})})},m=function(e){return 0==e?e:e?"object"==typeof e?e.element?e.element:e.text||"":e:""};t.a=function(e){var t=e.rows,n=e.columns,d=e.onDeleteRow,b=void 0===d?void 0:d,j=e.deleteRowLabel,x=void 0===j?void 0:j,g=e.onEditRow,v=void 0===g?void 0:g,k=e.editRowLabel,w=void 0===k?void 0:k,y=e.selectionMode,C=void 0===y?"none":y,S=e.selectedRowKeys,I=void 0===S?{}:S,M=e.onSelectedRowKeysChanged,R=void 0===M?void 0:M,U=Object(f.useMemo)((function(){var e={};return Object.keys(I).forEach((function(t){e[t]=I[t]})),e}),[I]),D=Object(f.useState)(null),E=Object(i.a)(D,2),J=E[0],F=E[1],T=Object(f.useCallback)((function(e){R&&("single"===C?e in U&&U[e]?R([]):R([e+""]):"multiple"===C&&R(Object.keys(U).filter((function(t){return t!=e&&U[t]})).concat(U[e]?[]:[e.toString()])))}),[R,C,U]),W=Object(f.useCallback)((function(e){F(e)}),[]),V=Object(f.useCallback)((function(e,t){t&&b&&b(e),F(null)}),[b]),N=Object(f.useCallback)((function(e){v&&v(e)}),[v]);return Object(c.jsxs)(r.a,{className:"NiceTable",children:[Object(c.jsx)(o.a,{children:Object(c.jsxs)(a.a,{children:[Object(c.jsx)(s.a,{style:{width:0}},"_first"),n.map((function(e){return Object(c.jsx)(s.a,{children:Object(c.jsx)("span",{children:e.label})},e.key)}))]})}),Object(c.jsx)(l.a,{children:t.map((function(e){return Object(c.jsxs)(a.a,{children:[Object(c.jsxs)(s.a,{children:[b&&(J===e.key?Object(c.jsx)(p,{title:x||"",onConfirmDeleteRow:V,rowKey:e.key}):Object(c.jsx)(O,{title:x||"",onDeleteRow:W,rowKey:e.key})),v&&Object(c.jsx)(h,{title:w||"",onEditRow:N,rowKey:e.key}),"none"!==C&&Object(c.jsx)(u.a,{checked:U[e.key]||!1,onClick:function(){return T(e.key)}})]}),n.map((function(t){return Object(c.jsx)(s.a,{children:Object(c.jsx)("span",{children:m(e.columnValues[t.key])})},t.key)}))]},e.key)}))})]})}},261:function(e,t,n){},720:function(e,t,n){"use strict";n.r(t),n.d(t,"activate",(function(){return H}));var c=n(13),i=n(9),r=n(683),o=n(0),a=n(120),s=n(710),l=n(613),u=n(18),d=n(161),b=function(){var e=Object(o.useState)([]),t=Object(i.a)(e,2),n=t[0],c=t[1],r=Object(o.useContext)(u.a);return Object(o.useEffect)((function(){var e=setInterval((function(){var e=r.getHitherJobs();c(e)}),1e3);return function(){clearInterval(e)}}),[r]),{pendingJobs:n.filter((function(e){return"pending"===e.status})),runningJobs:n.filter((function(e){return"running"===e.status})),finishedJobs:n.filter((function(e){return"finished"===e.status})),erroredJobs:n.filter((function(e){return"error"===e.status})),allJobs:n}},j=function(e){var t=e.onClick,n=b(),i=n.pendingJobs,r=n.runningJobs,o=n.finishedJobs,a=n.erroredJobs,s=i.length,l=r.length,u=o.length,j=a.length,f="Jobs: ".concat(s," pending | ").concat(l," running | ").concat(u," finished | ").concat(j," errored"),O=j>0?Object(c.jsxs)("span",{children:[":",Object(c.jsx)("span",{style:{color:"pink"},children:j})]}):Object(c.jsx)("span",{});return Object(c.jsx)(d.a,{onClick:t,color:"white",children:Object(c.jsxs)("span",{title:f,style:{fontFamily:"courier"},children:[s,":",l,":",u,O]})})},f=n(195),O=n(705),p=n(708),h=n(709),m=function(e){var t=e.color,n=Object(o.useContext)(u.c),i=n.websocketStatus,r=n.onReconnectWebsocket,a=Object(o.useMemo)((function(){switch(i){case"waiting":return{icon:Object(c.jsx)(O.a,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:Object(c.jsx)(p.a,{style:{color:t}}),title:"Connected"};case"disconnected":return{icon:Object(c.jsx)(h.a,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[i,t]),s=a.icon,l=a.title,d=Object(o.useCallback)((function(){"disconnected"===i&&r()}),[i,r]);return Object(c.jsx)(f.a,{title:l,onClick:d,children:s})},x=n(636),g=function(e){var t=e.onOpenSettings,n=e.color,i=Object(o.useMemo)((function(){return{icon:Object(c.jsx)(x.a,{}),title:"Open settings"}}),[]),r=i.icon,a=i.title,s=Object(o.useCallback)((function(){t()}),[t]);return Object(c.jsx)(f.a,{style:{color:n},title:a,onClick:s,children:r})},v={paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold",cursor:"pointer"},k=function(e){var t=e.onOpenSettings,n=e.onOpenJobMonitor,i=e.workspaceRouteDispatch,r=e.logo,a=Object(o.useCallback)((function(){i({type:"gotoRecordingsPage"})}),[i]);return Object(c.jsx)(s.a,{position:"static",style:{height:50,color:"white"},children:Object(c.jsxs)(l.a,{children:[r&&Object(c.jsx)("img",{src:r,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:a}),"\xa0\xa0\xa0",Object(c.jsx)("div",{style:v,onClick:a,children:"Labbox Ephys"}),Object(c.jsx)("span",{style:{marginLeft:"auto"}}),Object(c.jsxs)("span",{style:{paddingBottom:0,color:"white"},children:[Object(c.jsx)(g,{onOpenSettings:t,color:"white"}),Object(c.jsx)(m,{color:"white"}),Object(c.jsx)(j,{onClick:n})]})]})})},w=n(711),y=n(196),C=n(198),S=n(199),I=n(200),M=n(201),R=n(202),U=function(e){var t=e.job,n=t.kwargs&&D(t.kwargs).length>50,r=t.kwargs&&D(t.kwargs).length>1e3,a=Object(o.useState)(!n),s=Object(i.a)(a,2),l=s[0],u=s[1],d=t.result&&D(t.result).length>50,b=t.result&&D(t.result).length>1e3,j=Object(o.useState)(!d),f=Object(i.a)(j,2),O=f[0],p=f[1],h=l?Object(c.jsxs)("div",{children:[n&&Object(c.jsx)(y.a,{onClick:function(){return u(!1)},children:"Collapse"}),Object(c.jsx)("pre",{children:t.kwargs?D(t.kwargs):""})]}):r?Object(c.jsx)(y.a,{onClick:function(){console.info(t.kwargs)},title:"Write input argumetns to the browser developer tools console",children:"Write input arguments to console"}):Object(c.jsx)(y.a,{onClick:function(){console.info(t.kwargs),u(!0)},children:"Expand"}),m=O?Object(c.jsxs)("div",{children:[d&&Object(c.jsx)(y.a,{onClick:function(){return p(!1)},children:"Collapse"}),Object(c.jsx)("pre",{children:t.result?D(t.result):""})]}):b?Object(c.jsx)(y.a,{onClick:function(){console.info(t.result)},title:"Write result to the browser developer tools console",children:"Write result to console"}):Object(c.jsx)(y.a,{onClick:function(){console.info(t.result),p(!0)},children:"Expand"}),x=[{label:"Job ID",value:t.jobId},{label:"Function name",value:t.functionName},{label:"Input arguments",value:h},{label:"Status",value:t.status},{label:"Started",value:t.timestampStarted?E(new Date(t.timestampStarted)):""},{label:"Finished",value:t.timestampFinished?E(new Date(t.timestampFinished)):""},{label:"Result",value:m},{label:"Error message",value:t.error_message}];return Object(c.jsx)("div",{children:Object(c.jsxs)(C.a,{className:"NiceTable",children:[Object(c.jsx)(S.a,{}),Object(c.jsx)(I.a,{children:x.map((function(e){return Object(c.jsxs)(M.a,{children:[Object(c.jsx)(R.a,{children:e.label}),Object(c.jsx)(R.a,{children:e.value})]},e.label)}))})]})})};function D(e){return JSON.stringify(e,null,4)}function E(e){var t,n,c="";return t=e,n=new Date,(t.getFullYear()!==n.getFullYear()||t.getMonth()!==n.getMonth()||t.getDate()!==n.getDate())&&(c+="".concat(e.getMonth()+1,"/").concat(e.getDate(),"/").concat(e.getFullYear(),"} ")),c+="".concat(e.toLocaleTimeString())}var J=function(e){var t=e.job,n=e.onBack;return Object(c.jsxs)("div",{children:[Object(c.jsx)("p",{children:Object(c.jsx)(d.a,{onClick:n,children:"Back to jobs"})}),Object(c.jsx)(U,{job:t})]})},F=n(10),T=n(247),W=n(637);function V(e){var t,n,c="";return t=e,n=new Date,(t.getFullYear()!==n.getFullYear()||t.getMonth()!==n.getMonth()||t.getDate()!==n.getDate())&&(c+="".concat(e.getMonth()+1,"/").concat(e.getDate(),"/").concat(e.getFullYear(),"} ")),c+="".concat(e.toLocaleTimeString())}var N=function(e){var t=e.onClick;return Object(c.jsx)(f.a,{title:"Cancel job",onClick:t,children:Object(c.jsx)(W.a,{})})},K=function(e){var t=e.jobs,n=e.onViewJob,i=e.onCancelJob,r=Object(o.useMemo)((function(){return[{key:"jobId",label:"Job"},{key:"functionName",label:"Function"},{key:"status",label:"Status"},{key:"started",label:"Started"},{key:"finished",label:"Finished"},{key:"message",label:"Message"}]}),[]),a=Object(o.useMemo)((function(){return Object(F.a)(t).sort((function(e,t){return"running"===e.status&&"running"!==t.status?-1:"running"===t.status&&"running"!==e.status?1:e.timestampStarted&&t.timestampStarted?e.timestampStarted<t.timestampStarted?1:t.timestampStarted<e.timestampStarted?-1:0:0}))}),[t]),s=Object(o.useMemo)((function(){return a.map((function(e){return{key:e.jobId||"null",columnValues:{jobId:{text:e.jobId,element:Object(c.jsx)(d.a,{onClick:function(){n&&n(e)},children:e.jobId})},functionName:{text:e.functionName},status:{text:e.status,element:"running"===e.status?Object(c.jsxs)("span",{children:[Object(c.jsxs)("span",{children:[e.status," "]}),Object(c.jsx)(N,{onClick:function(){i&&i(e)}})]}):Object(c.jsx)("span",{children:e.status})},started:{text:e.timestampStarted?V(new Date(e.timestampStarted)):""},finished:{text:e.timestampFinished?V(new Date(e.timestampFinished)):""},message:{text:e.error_message||""}}}}))}),[a]);return Object(c.jsx)(T.a,{rows:s,columns:r})},L=Object(w.a)((function(e){return{paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}})),z=function(){var e=L(),t=b().allJobs,n=Object(o.useState)(null),r=Object(i.a)(n,2),a=r[0],s=r[1],l=Object(o.useCallback)((function(e){s(e)}),[]),u=Object(o.useCallback)((function(){}),[]),d=Object(o.useCallback)((function(){s(null)}),[]);return Object(c.jsxs)("div",{className:e.paper,style:{zIndex:9999},children:[Object(c.jsx)("h2",{children:"Job Monitor"}),a?Object(c.jsx)(J,{job:a,onBack:d}):Object(c.jsx)(K,{jobs:t,onViewJob:l,onCancelJob:u})]})},B=Object(w.a)((function(e){return{paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}})),Y=function(e){var t=e.workspaceUri,n=e.version,i=B(),r=Object(o.useContext)(u.c).serverInfo;return Object(c.jsxs)("div",{className:i.paper,style:{zIndex:9999},children:[Object(c.jsxs)("h2",{children:["Labbox Ephys ",n]}),Object(c.jsxs)(C.a,{children:[Object(c.jsxs)(M.a,{children:[Object(c.jsx)(R.a,{children:"Workspace URI"}),Object(c.jsx)(R.a,{children:t||""})]}),Object(c.jsxs)(M.a,{children:[Object(c.jsx)(R.a,{children:"Kachery node ID"}),Object(c.jsx)(R.a,{children:r?r.nodeId:""})]}),Object(c.jsxs)(M.a,{children:[Object(c.jsx)(R.a,{children:"Default feed ID"}),Object(c.jsx)(R.a,{children:r?r.defaultFeedId:""})]})]})]})};function A(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}var _=function(e){var t=e.workspace,n=e.workspaceDispatch,s=e.workspaceRoute,l=e.workspaceRouteDispatch,u=e.version,d=e.width,b=e.height,j=function(){var e=Object(o.useState)(A()),t=Object(i.a)(e,2),n=t[0],c=t[1];return Object(o.useEffect)((function(){function e(){c(A())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),f=j.width,O=j.height,p=(b||O)-52-2,h=(d||f)-0-2,m=Object(a.j)().filter((function(e){return"WorkspaceView"===e.name}))[0];if(!m)throw Error("Unable to find workspace view plugin");var x=Object(o.useState)(!1),g=Object(i.a)(x,2),v=g[0],w=g[1],y=Object(o.useState)(!1),C=Object(i.a)(y,2),S=C[0],I=C[1],M=Object(o.useCallback)((function(){w(!0)}),[]),R=Object(o.useCallback)((function(){I(!0)}),[]),U=Object(o.useCallback)((function(){w(!1)}),[]),D=Object(o.useCallback)((function(){I(!1)}),[]);return Object(c.jsxs)("div",{style:{margin:0},children:[Object(c.jsx)(k,{onOpenSettings:M,onOpenJobMonitor:R,workspaceRouteDispatch:l}),Object(c.jsx)("div",{style:{position:"absolute",top:52},children:Object(c.jsx)(m.component,{width:h,height:p,workspace:t,workspaceDispatch:n,workspaceRoute:s,workspaceRouteDispatch:l})}),Object(c.jsx)(r.a,{open:v,onClose:U,style:{zIndex:9999},children:Object(c.jsx)("span",{children:Object(c.jsx)(Y,{workspace:t,workspaceUri:s.workspaceUri,version:u})})}),Object(c.jsx)(r.a,{open:S,onClose:D,style:{zIndex:9999},children:Object(c.jsx)("span",{children:Object(c.jsx)(z,{})})})]})};function H(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:_})}}}]);
//# sourceMappingURL=23.df69a87c.chunk.js.map