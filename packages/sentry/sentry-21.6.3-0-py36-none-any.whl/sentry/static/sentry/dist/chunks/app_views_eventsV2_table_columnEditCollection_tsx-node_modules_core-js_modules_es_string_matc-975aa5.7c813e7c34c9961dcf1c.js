(self.webpackChunk=self.webpackChunk||[]).push([["app_views_eventsV2_table_columnEditCollection_tsx-node_modules_core-js_modules_es_string_matc-975aa5"],{"./app/utils/userselect.tsx":(e,t,n)=>{"use strict";n.d(t,{l:()=>o});var o=function(e){var t={userSelect:document.body.style.userSelect,MozUserSelect:document.body.style.MozUserSelect,msUserSelect:document.body.style.msUserSelect,webkitUserSelect:document.body.style.webkitUserSelect};return document.body.style.userSelect=e.userSelect||"",document.body.style.MozUserSelect=e.MozUserSelect||"",document.body.style.msUserSelect=e.msUserSelect||"",document.body.style.webkitUserSelect=e.webkitUserSelect||"",t}},"./app/views/eventsV2/table/columnEditCollection.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>P}),n("../node_modules/core-js/modules/es.reflect.construct.js");var o=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),l=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),a=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),c=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),m=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.array.find.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/react/index.js")),g=n("../node_modules/react-dom/index.js"),p=n("./app/components/acl/feature.tsx"),f=n("./app/components/button.tsx"),h=n("./app/components/charts/styles.tsx"),v=n("./app/components/featureBadge.tsx"),b=n("./app/icons/index.tsx"),y=n("./app/locale.tsx"),x=n("./app/styles/space.tsx"),j=n("./app/utils/discover/fields.tsx"),Z=n("./app/utils/theme.tsx");function _(e,t){var n="nativeEvent"in e?e.nativeEvent:e;return window.TouchEvent&&n instanceof TouchEvent?n.targetTouches[0][t]:n instanceof MouseEvent?n[t]:0}var w=n("./app/utils/userselect.tsx"),C=n("./app/views/eventsV2/table/queryField.tsx"),S=n("./app/views/eventsV2/table/types.tsx"),E=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");var k,D="draggable-item";!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(k||(k={}));var T=function(e){(0,l.Z)(h,e);var t,n,c=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,d.Z)(t);if(n){var r=(0,d.Z)(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return(0,a.Z)(this,e)});function h(){var e;(0,r.Z)(this,h);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return e=c.call.apply(c,[this].concat(n)),(0,u.Z)((0,i.Z)(e),"state",{isDragging:!1,draggingIndex:void 0,draggingTargetIndex:void 0,draggingGrabbedOffset:void 0,left:void 0,top:void 0}),(0,u.Z)((0,i.Z)(e),"previousUserSelect",null),(0,u.Z)((0,i.Z)(e),"portal",null),(0,u.Z)((0,i.Z)(e),"dragGhostRef",m.createRef()),(0,u.Z)((0,i.Z)(e),"handleAddColumn",(function(){e.props.onChange([].concat((0,o.Z)(e.props.columns),[{kind:"field",field:""}]))})),(0,u.Z)((0,i.Z)(e),"handleAddEquation",(function(){var t={kind:S.L.EQUATION,field:""};e.props.onChange([].concat((0,o.Z)(e.props.columns),[t]))})),(0,u.Z)((0,i.Z)(e),"handleUpdateColumn",(function(t,n){var r=(0,o.Z)(e.props.columns);r.splice(t,1,n),e.props.onChange(r)})),(0,u.Z)((0,i.Z)(e),"onDragMove",(function(t){var n,o,r=e.state,s=r.isDragging,i=r.draggingTargetIndex,l=r.draggingGrabbedOffset;if(s&&["mousemove","touchmove"].includes(t.type)){t.preventDefault(),t.stopPropagation();var a=_(t,"pageX"),d=_(t,"pageY"),u=null!==(n=null==l?void 0:l.x)&&void 0!==n?n:0,c=null!==(o=null==l?void 0:l.y)&&void 0!==o?o:0;if(e.dragGhostRef.current){var m=e.dragGhostRef.current;m.style.left="".concat(a-u,"px"),m.style.top="".concat(d-c,"px")}var g=document.querySelectorAll(".".concat(D)),p=Array.from(g).findIndex((function(e){var t=e.getBoundingClientRect(),n=d,o=window.scrollY+t.top,r=window.scrollY+t.top+t.height;return n>=o&&n<=r}));p>=0&&p!==i&&e.setState({draggingTargetIndex:p})}})),(0,u.Z)((0,i.Z)(e),"onDragEnd",(function(t){if(e.state.isDragging&&["mouseup","touchend"].includes(t.type)){var n=e.state.draggingIndex,r=e.state.draggingTargetIndex;if("number"==typeof n&&"number"==typeof r){e.cleanUpListeners(),e.previousUserSelect&&((0,w.l)(e.previousUserSelect),e.previousUserSelect=null);var s=(0,o.Z)(e.props.columns),i=s.splice(n,1);s.splice(r,0,i[0]),e.props.onChange(s),e.setState({isDragging:!1,left:void 0,top:void 0,draggingIndex:void 0,draggingTargetIndex:void 0,draggingGrabbedOffset:void 0})}}})),e}return(0,s.Z)(h,[{key:"componentDidMount",value:function(){if(!this.portal){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex=String(Z.ZP.zIndex.modal),this.portal=e,document.body.appendChild(this.portal)}}},{key:"componentWillUnmount",value:function(){this.portal&&document.body.removeChild(this.portal),this.cleanUpListeners()}},{key:"keyForColumn",value:function(e,t){return"function"===e.kind?[].concat((0,o.Z)(e.function),[t]).join(":"):[].concat((0,o.Z)(e.field),[t]).join(":")}},{key:"cleanUpListeners",value:function(){this.state.isDragging&&(window.removeEventListener("mousemove",this.onDragMove),window.removeEventListener("touchmove",this.onDragMove),window.removeEventListener("mouseup",this.onDragEnd),window.removeEventListener("touchend",this.onDragEnd))}},{key:"removeColumn",value:function(e){var t=(0,o.Z)(this.props.columns);t.splice(e,1),this.props.onChange(t)}},{key:"startDrag",value:function(e,t){if(!this.state.isDragging&&["mousedown","touchstart"].includes(e.type)){e.preventDefault(),e.stopPropagation();var n=_(e,"pageY"),o=_(e,"pageX"),r=Array.from(document.querySelectorAll(".".concat(D))).find((function(t){return t.contains(e.currentTarget)})).getBoundingClientRect(),s={x:o-r.x+4,y:n-r.y+4};this.previousUserSelect=(0,w.l)({userSelect:"none",MozUserSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}),window.addEventListener("mousemove",this.onDragMove),window.addEventListener("touchmove",this.onDragMove),window.addEventListener("mouseup",this.onDragEnd),window.addEventListener("touchend",this.onDragEnd),this.setState({isDragging:!0,draggingIndex:t,draggingTargetIndex:t,draggingGrabbedOffset:s,top:n,left:o})}}},{key:"renderGhost",value:function(e){var t,n,o=this.state,r=o.isDragging,s=o.draggingIndex,i=o.draggingGrabbedOffset,l=s;if("number"!=typeof l||!r||!this.portal)return null;var a=null!==(t=null==i?void 0:i.x)&&void 0!==t?t:0,d=null!==(n=null==i?void 0:i.y)&&void 0!==n?n:0,u=Number(this.state.top)-d,c=Number(this.state.left)-a,m=this.props.columns[l],p={top:"".concat(u,"px"),left:"".concat(c,"px")},f=(0,E.tZ)(O,{ref:this.dragGhostRef,style:p,children:this.renderItem(m,l,{isGhost:!0,gridColumns:e})});return g.createPortal(f,this.portal)}},{key:"renderItem",value:function(e,t,n){var o=this,r=n.canDelete,s=void 0===r||r,i=n.isGhost,l=void 0!==i&&i,a=n.gridColumns,d=void 0===a?2:a,u=this.props,c=u.columns,g=u.fieldOptions,p=this.state,h=p.isDragging,v=p.draggingTargetIndex,x=p.draggingIndex,j=null;if(h&&!1===l&&v===t&&(j=(0,E.tZ)(R,{className:D},"placeholder:".concat(this.keyForColumn(e,l)))),h&&!1===l&&x===t)return j;var Z=Number(v)<=Number(x)?k.TOP:k.BOTTOM;return(0,E.BX)(m.Fragment,{children:[Z===k.TOP&&j,(0,E.BX)(U,{className:l?"":D,children:[s?(0,E.tZ)(f.ZP,{"aria-label":(0,y.t)("Drag to reorder"),onMouseDown:function(e){return o.startDrag(e,t)},onTouchStart:function(e){return o.startDrag(e,t)},icon:(0,E.tZ)(b.LS,{size:"xs"}),size:"zero",borderless:!0}):(0,E.tZ)("span",{}),(0,E.tZ)(C.q,{fieldOptions:g,gridColumns:d,fieldValue:e,onChange:function(e){return o.handleUpdateColumn(t,e)},takeFocus:t===this.props.columns.length-1,otherColumns:c}),s?(0,E.tZ)(f.ZP,{"aria-label":(0,y.t)("Remove column"),onClick:function(){return o.removeColumn(t)},icon:(0,E.tZ)(b.Fz,{}),borderless:!0}):(0,E.tZ)("span",{})]}),Z===k.BOTTOM&&j]},"".concat(t,":").concat(this.keyForColumn(e,l)))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.columns,s=t.organization,i=r.length>1,l=r.length<20,a=l?void 0:"Sorry, you reached the maximum number of columns. Delete columns to add more.",d=Math.max.apply(Math,(0,o.Z)(r.map((function(e){return"function"===e.kind&&2===j.lx[e.function[0]].parameters.length?3:2}))));return(0,E.BX)("div",{className:n,children:[this.renderGhost(d),(0,E.tZ)(U,{children:(0,E.BX)(M,{gridColumns:d,children:[(0,E.tZ)(z,{children:(0,y.t)("Tag / Field / Function")}),(0,E.tZ)(z,{children:(0,y.t)("Field Parameter")})]})}),r.map((function(t,n){return e.renderItem(t,n,{canDelete:i,gridColumns:d})})),(0,E.tZ)(U,{children:(0,E.BX)(A,{children:[(0,E.tZ)(f.ZP,{size:"small",label:(0,y.t)("Add a Column"),onClick:this.handleAddColumn,title:a,disabled:!l,icon:(0,E.tZ)(b.N_,{isCircled:!0,size:"xs"}),children:(0,y.t)("Add a Column")}),(0,E.tZ)(p.Z,{organization:s,features:["discover-arithmetic"],children:(0,E.BX)(f.ZP,{size:"small",label:(0,y.t)("Add an Equation"),onClick:this.handleAddEquation,title:a,disabled:!l,icon:(0,E.tZ)(b.N_,{isCircled:!0,size:"xs"}),children:[(0,y.t)("Add an Equation"),(0,E.tZ)(I,{type:"beta"})]})})]})})]})}}]),h}(m.Component);T.displayName="ColumnEditCollection";var I=(0,c.Z)(v.Z,{target:"ev0fm796"})("margin:-",(0,x.Z)(.5)," auto;margin-left:",(0,x.Z)(1),";"),U=(0,c.Z)("div",{target:"ev0fm795"})("display:grid;grid-template-columns:",(0,x.Z)(3)," 1fr ",(0,x.Z)(3),";justify-content:center;align-items:center;width:100%;touch-action:none;padding-bottom:",(0,x.Z)(1),";"),O=(0,c.Z)("div",{target:"ev0fm794"})("background:",(function(e){return e.theme.background}),";display:block;position:absolute;padding:",4,"px;border-radius:",(function(e){return e.theme.borderRadius}),";box-shadow:0 0 15px rgba(0, 0, 0, 0.15);width:710px;opacity:0.8;cursor:grabbing;padding-right:",(0,x.Z)(2),";&>",U,"{padding-bottom:0;}& svg{cursor:grabbing;}"),R=(0,c.Z)("div",{target:"ev0fm793"})("margin:0 ",(0,x.Z)(3)," ",(0,x.Z)(1)," ",(0,x.Z)(3),";border:2px dashed ",(function(e){return e.theme.border}),";border-radius:",(function(e){return e.theme.borderRadius}),";height:41px;"),A=(0,c.Z)("div",{target:"ev0fm792"})("grid-column:2/3;& button{margin-right:",(0,x.Z)(1),";}"),M=(0,c.Z)("div",{target:"ev0fm791"})("grid-column:2/3;display:grid;grid-template-columns:repeat(",(function(e){return e.gridColumns}),", 1fr);grid-column-gap:",(0,x.Z)(1),";"),z=(0,c.Z)(h.OT,{target:"ev0fm790"})({name:"ti75j2",styles:"margin:0"});const P=T},"../node_modules/core-js/modules/es.string.match-all.js":(e,t,n)=>{"use strict";var o=n("../node_modules/core-js/internals/export.js"),r=n("../node_modules/core-js/internals/create-iterator-constructor.js"),s=n("../node_modules/core-js/internals/require-object-coercible.js"),i=n("../node_modules/core-js/internals/to-length.js"),l=n("../node_modules/core-js/internals/a-function.js"),a=n("../node_modules/core-js/internals/an-object.js"),d=n("../node_modules/core-js/internals/classof-raw.js"),u=n("../node_modules/core-js/internals/is-regexp.js"),c=n("../node_modules/core-js/internals/regexp-flags.js"),m=n("../node_modules/core-js/internals/create-non-enumerable-property.js"),g=n("../node_modules/core-js/internals/fails.js"),p=n("../node_modules/core-js/internals/well-known-symbol.js"),f=n("../node_modules/core-js/internals/species-constructor.js"),h=n("../node_modules/core-js/internals/advance-string-index.js"),v=n("../node_modules/core-js/internals/internal-state.js"),b=n("../node_modules/core-js/internals/is-pure.js"),y=p("matchAll"),x="RegExp String Iterator",j=v.set,Z=v.getterFor(x),_=RegExp.prototype,w=_.exec,C="".matchAll,S=!!C&&!g((function(){"a".matchAll(/./)})),E=r((function(e,t,n,o){j(this,{type:x,regexp:e,string:t,global:n,unicode:o,done:!1})}),"RegExp String",(function(){var e=Z(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,o=function(e,t){var n,o=e.exec;if("function"==typeof o){if("object"!=typeof(n=o.call(e,t)))throw TypeError("Incorrect exec result");return n}return w.call(e,t)}(t,n);return null===o?{value:void 0,done:e.done=!0}:e.global?(""==String(o[0])&&(t.lastIndex=h(n,i(t.lastIndex),e.unicode)),{value:o,done:!1}):(e.done=!0,{value:o,done:!1})})),k=function(e){var t,n,o,r,s,l,d=a(this),u=String(e);return t=f(d,RegExp),void 0===(n=d.flags)&&d instanceof RegExp&&!("flags"in _)&&(n=c.call(d)),o=void 0===n?"":String(n),r=new t(t===RegExp?d.source:d,o),s=!!~o.indexOf("g"),l=!!~o.indexOf("u"),r.lastIndex=i(d.lastIndex),new E(r,u,s,l)};o({target:"String",proto:!0,forced:S},{matchAll:function(e){var t,n,o,r=s(this);if(null!=e){if(u(e)&&!~String(s("flags"in _?e.flags:c.call(e))).indexOf("g"))throw TypeError("`.matchAll` does not allow non-global regexes");if(S)return C.apply(r,arguments);if(void 0===(n=e[y])&&b&&"RegExp"==d(e)&&(n=k),null!=n)return l(n).call(e,r)}else if(S)return C.apply(r,arguments);return t=String(r),o=new RegExp(e,"g"),b?k.call(o,t):o[y](t)}}),b||y in _||m(_,y,k)}}]);
//# sourceMappingURL=../sourcemaps/app_views_eventsV2_table_columnEditCollection_tsx-node_modules_core-js_modules_es_string_matc-975aa5.3b6dcd3679cbeab49db3416ad25b60e9.js.map