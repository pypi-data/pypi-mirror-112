!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["perspective-viewer-datagrid"]=e():t["perspective-viewer-datagrid"]=e()}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=45)}([function(t,e,i){(function(e){var i=function(t){return t&&t.Math==Math&&t};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof e&&e)||Function("return this")()}).call(this,i(20))},function(t,e,i){var r=i(0),o=i(46),n=i(47),s=i(4),a=i(7),l=a("iterator"),c=a("toStringTag"),u=n.values;for(var d in o){var _=r[d],h=_&&_.prototype;if(h){if(h[l]!==u)try{s(h,l,u)}catch(t){h[l]=u}if(h[c]||s(h,c,d),o[d])for(var p in n)if(h[p]!==n[p])try{s(h,p,n[p])}catch(t){h[p]=n[p]}}}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){"use strict";i(41),i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.getCellConfig=async function({view:t,config:e},i,r){const o=e.row_pivots,n=e.column_pivots,s=i>=0?i:0,a=s+1,l=await t.to_json({start_row:s,end_row:a}),c=l.map(t=>t.__ROW_PATH__)[0]||[],u=o.map((t,e)=>{const i=c[e];return i?[t,"==",i]:void 0}).filter(t=>t),d=o.length>0?r+1:r,_=Object.keys(l[0])[d],h={row:l[0]};let p=[];if(_){const t=_.split("|");h.column_names=[t[t.length-1]],p=n.map((e,i)=>{const r=t[i];return r?[e,"==",r]:void 0}).filter(t=>t).filter(([,,t])=>"__ROW_PATH__"!==t)}const f=e.filter.concat(u).concat(p);return h.config={filters:f},h},e.log_perf=function(t){o.push(t)},e._start_profiling_loop=function(){r.DEBUG&&setInterval(n,5e3)},e.memoize=function(t,e,i){const r=new Map,o=i.value;return i.value=function(t){if(r.has(t))return r.get(t);{const e=o.call(this,t);return r.set(t,e),e}},i},e.column_path_2_type=function(t,e){const i=e.split("|");return t[i[i.length-1]]},e.isEqual=function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;let r,o,n;if(Array.isArray(e)){if(r=e.length,r!=i.length)return!1;for(o=r;0!=o--;)if(!t(e[o],i[o]))return!1;return!0}if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(n=Object.keys(e),r=n.length,r!==Object.keys(i).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(i,n[o]))return!1;for(o=r;0!=o--;){let r=n[o];if(!t(e[r],i[r]))return!1}return!0}return e!=e&&i!=i},e.throttlePromise=function(t,e,i){const r=Symbol("private lock"),o=i.value;return i.value=async function(...t){if(this[r]&&(await this[r],this[r]))return void await this[r];let e;this[r]=l();try{e=await o.call(this,...t)}catch(t){console.error(t)}finally{const t=this[r];return this[r]=void 0,t.resolve(),e}},i},e.get_type_config=function t(e){const i={};c[e]&&Object.assign(i,c[e]);if(i.type){const e=t(i.type);return Object.assign(e,i),e}return i},e.default_types=e.css=e.html=void 0;var r=i(6);let o=[];function n(){const t=o.reduce((t,e)=>t+e,0)/o.length,e=o.length/5,i=1e3/t,r=o.length;console.log(`${t.toFixed(2)} ms/frame   ${e} rfps   ${i.toFixed(2)} vfps   (${r} frames in 5s)`),o=[]}const s=(t,...e)=>t.map((t,i)=>[t,e[i]]).flat().filter(t=>!!t).join("");e.html=s;const a=s;e.css=a;const l=()=>{let t;const e=new Promise(e=>{t=e});return e.resolve=t,e};const c={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric"},null_value:-1}}};e.default_types=c},function(t,e,i){var r=i(8),o=i(9),n=i(15);t.exports=r?function(t,e,i){return o.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){"use strict";i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.ICON_MAP=e.BROWSER_MAX_HEIGHT=e.DOUBLE_BUFFER_RECREATE=e.DOUBLE_BUFFER_ROW=e.DOUBLE_BUFFER_COLUMN=e.DEBUG=e.METADATA_MAP=void 0;const r=new WeakMap;e.METADATA_MAP=r;e.DEBUG=!1;e.DOUBLE_BUFFER_COLUMN=!1;e.DOUBLE_BUFFER_ROW=!1;e.DOUBLE_BUFFER_RECREATE=!1;e.BROWSER_MAX_HEIGHT=1e7;e.ICON_MAP={asc:"arrow_upward",desc:"arrow_downward","asc abs":"\u21e7","desc abs":"\u21e9","col asc":"arrow_back","col desc":"arrow_forward","col asc abs":"\u21e8","col desc abs":"\u21e6"}},function(t,e,i){var r=i(0),o=i(23),n=i(2),s=i(28),a=i(29),l=i(50),c=o("wks"),u=r.Symbol,d=l?u:u&&u.withoutSetter||s;t.exports=function(t){return n(c,t)||(a&&n(u,t)?c[t]=u[t]:c[t]=d("Symbol."+t)),c[t]}},function(t,e,i){var r=i(5);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e,i){var r=i(8),o=i(25),n=i(11),s=i(27),a=Object.defineProperty;e.f=r?a:function(t,e,i){if(n(t),e=s(e,!0),n(i),o)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var r=i(10);t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,i){var r=i(48),o=i(21);t.exports=function(t){return r(o(t))}},function(t,e){t.exports=!1},function(t,e,i){var r=i(0),o=i(4);t.exports=function(t,e){try{o(r,t,e)}catch(i){r[t]=e}return e}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){t.exports={}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e,i){var r=i(23),o=i(28),n=r("keys");t.exports=function(t){return n[t]||(n[t]=o(t))}},function(t,e){t.exports={}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,i){var r=i(7),o=i(30),n=i(9),s=r("unscopables"),a=Array.prototype;null==a[s]&&n.f(a,s,{configurable:!0,value:o(null)}),t.exports=function(t){a[s][t]=!0}},function(t,e,i){var r=i(13),o=i(24);(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.4",mode:r?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var r=i(0),o=i(14),n=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=n},function(t,e,i){var r=i(8),o=i(5),n=i(26);t.exports=!r&&!o((function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},function(t,e,i){var r=i(0),o=i(10),n=r.document,s=o(n)&&o(n.createElement);t.exports=function(t){return s?n.createElement(t):{}}},function(t,e,i){var r=i(10);t.exports=function(t,e){if(!r(t))return t;var i,o;if(e&&"function"==typeof(i=t.toString)&&!r(o=i.call(t)))return o;if("function"==typeof(i=t.valueOf)&&!r(o=i.call(t)))return o;if(!e&&"function"==typeof(i=t.toString)&&!r(o=i.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){var i=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++i+r).toString(36)}},function(t,e,i){var r=i(5);t.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},function(t,e,i){var r,o=i(11),n=i(51),s=i(17),a=i(16),l=i(56),c=i(26),u=i(18),d=u("IE_PROTO"),_=function(){},h=function(t){return"<script>"+t+"<\/script>"},p=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;p=r?function(t){t.write(h("")),t.close();var e=t.parentWindow.Object;return t=null,e}(r):((e=c("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(h("document.F=Object")),t.close(),t.F);for(var i=s.length;i--;)delete p.prototype[s[i]];return p()};a[d]=!0,t.exports=Object.create||function(t,e){var i;return null!==t?(_.prototype=o(t),i=new _,_.prototype=null,i[d]=t):i=p(),void 0===e?i:n(i,e)}},function(t,e,i){var r=i(2),o=i(12),n=i(53).indexOf,s=i(16);t.exports=function(t,e){var i,a=o(t),l=0,c=[];for(i in a)!r(s,i)&&r(a,i)&&c.push(i);for(;e.length>l;)r(a,i=e[l++])&&(~n(c,i)||c.push(i));return c}},function(t,e){var i=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:i)(t)}},function(t,e,i){var r=i(57),o=i(0),n=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?n(r[t])||n(o[t]):r[t]&&r[t][e]||o[t]&&o[t][e]}},function(t,e,i){var r,o,n,s=i(58),a=i(0),l=i(10),c=i(4),u=i(2),d=i(18),_=i(16),h=a.WeakMap;if(s){var p=new h,f=p.get,g=p.has,v=p.set;r=function(t,e){return v.call(p,t,e),e},o=function(t){return f.call(p,t)||{}},n=function(t){return g.call(p,t)}}else{var m=d("state");_[m]=!0,r=function(t,e){return c(t,m,e),e},o=function(t){return u(t,m)?t[m]:{}},n=function(t){return u(t,m)}}t.exports={set:r,get:o,has:n,enforce:function(t){return n(t)?o(t):r(t,{})},getterFor:function(t){return function(e){var i;if(!l(e)||(i=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}}}},function(t,e,i){var r=i(24),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return o.call(t)}),t.exports=r.inspectSource},function(t,e,i){var r=i(8),o=i(61),n=i(15),s=i(12),a=i(27),l=i(2),c=i(25),u=Object.getOwnPropertyDescriptor;e.f=r?u:function(t,e){if(t=s(t),e=a(e,!0),c)try{return u(t,e)}catch(t){}if(l(t,e))return n(!o.f.call(t,e),t[e])}},function(t,e,i){var r=i(0),o=i(4),n=i(2),s=i(14),a=i(35),l=i(34),c=l.get,u=l.enforce,d=String(String).split("String");(t.exports=function(t,e,i,a){var l=!!a&&!!a.unsafe,c=!!a&&!!a.enumerable,_=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof e||n(i,"name")||o(i,"name",e),u(i).source=d.join("string"==typeof e?e:"")),t!==r?(l?!_&&t[e]&&(c=!0):delete t[e],c?t[e]=i:o(t,e,i)):c?t[e]=i:s(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||a(this)}))},function(t,e,i){"use strict";var r,o,n,s=i(39),a=i(4),l=i(2),c=i(7),u=i(13),d=c("iterator"),_=!1;[].keys&&("next"in(n=[].keys())?(o=s(s(n)))!==Object.prototype&&(r=o):_=!0),null==r&&(r={}),u||l(r,d)||a(r,d,(function(){return this})),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:_}},function(t,e,i){var r=i(2),o=i(68),n=i(18),s=i(69),a=n("IE_PROTO"),l=Object.prototype;t.exports=s?Object.getPrototypeOf:function(t){return t=o(t),r(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?l:null}},function(t,e,i){var r=i(9).f,o=i(2),n=i(7)("toStringTag");t.exports=function(t,e,i){t&&!o(t=i?t:t.prototype,n)&&r(t,n,{configurable:!0,value:e})}},function(t,e,i){i(22)("flat")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ViewModel=void 0;var r,o=i(6),n=i(3),s=i(76);function a(t,e,i,r,o){var n={};return Object.keys(r).forEach((function(t){n[t]=r[t]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce((function(i,r){return r(t,e,i)||i}),n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(t,e,n),n=null),n}let l=(a((r=class{constructor(t,e,i){this._column_sizes=t,this._container=e,this.table=i,this.cells=[],this.rows=[]}num_rows(){return this.cells.length}_set_metadata(t,e){o.METADATA_MAP.set(t,e)}_get_or_create_metadata(t){if(o.METADATA_MAP.has(t))return o.METADATA_MAP.get(t);{const e={};return o.METADATA_MAP.set(t,e),e}}_format_text(t){const e=(0,n.get_type_config)(t),i=e.type||t,r={float:Intl.NumberFormat,integer:Intl.NumberFormat,datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat}[i];if(r){const t=new r("en-us",e.format);return e=>t.format(e)}return t=>t}_format_class(t){const e=(0,n.get_type_config)(t).type||t;return"integer"===e||"float"===e?t=>t>0?"pd-positive":t<0?"pd-negative":void 0:()=>""}_format(t){if(Array.isArray(t))return{format:s.tree_header.bind(this)};const e=this._format_text(t),i=this._format_class(t);return{format(t,r){t.textContent=e(r);const o=i(r);o&&t.classList.add(o)}}}_get_cell(t="td",e,i,r){let o=e[i];return o||(o=e[i]=document.createElement(t),r.appendChild(o)),o}_get_row(t){let e=this.rows[t];e||(e=this.rows[t]=document.createElement("tr"),this.table.appendChild(e));let i=this.cells[t];return i||(i=this.cells[t]=[]),{tr:e,row_container:i}}_clean_columns(t){for(let e=0;e<this.rows.length;e++){const i=this.rows[e],r=this.cells[e];let o=t[e]||t;for(;i.children[o];)i.removeChild(i.children[o]);this.cells[e]=r.slice(0,o)}}_clean_rows(t){for(;this.table.children[t];)this.table.removeChild(this.table.children[t]);this.rows=this.rows.slice(0,t),this.cells=this.cells.slice(0,t)}}).prototype,"_format_text",[n.memoize],Object.getOwnPropertyDescriptor(r.prototype,"_format_text"),r.prototype),a(r.prototype,"_format_class",[n.memoize],Object.getOwnPropertyDescriptor(r.prototype,"_format_class"),r.prototype),a(r.prototype,"_format",[n.memoize],Object.getOwnPropertyDescriptor(r.prototype,"_format"),r.prototype),r);e.ViewModel=l},function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return o}));i(1);function r(t){return function(e,i,r){const o=r.value;return r.set=function(e){let r=this.getAttribute(i);try{null!=e&&""!==e||(e=t()),"string"!=typeof e&&(e=JSON.stringify(e)),e!==r&&(r=e),r=JSON.parse(r)}catch(o){console.warn(`Invalid value for attribute "${i}": ${e}`),r=t()}o.call(this,r)},r.get=function(){return this.hasAttribute(i)?JSON.parse(this.getAttribute(i)):t()},delete r.value,delete r.writable,r}}r(()=>({})),r(()=>[]);const o=(e,i)=>{t.registerPlugin?t.registerPlugin(e,i):(t.__perspective_plugins__=t.__perspective_plugins__||[],t.__perspective_plugins__.push([e,i]))}}).call(this,i(20))},function(t,e,i){(e=t.exports=i(80)(!1)).push([t.i,"@import url(https://fonts.googleapis.com/css?family=Open+Sans);",""]),e.push([t.i,'regular-table{padding:12px}:host,regular-table{font-family:"Open Sans"}:host div[tabindex],regular-table div[tabindex]{outline:0}:host th,regular-table th{text-align:center;position:relative}:host thead tr:not(:last-child) th,regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0}:host tbody .pd-float,:host thead tr:last-child .pd-float,regular-table tbody .pd-float,regular-table thead tr:last-child .pd-float{text-align:right}:host tbody .pd-integer,:host thead .pd-integer,regular-table tbody .pd-integer,regular-table thead .pd-integer{text-align:right}:host .pd-positive,regular-table .pd-positive{color:#1078d1}:host .pd-negative,regular-table .pd-negative{color:#de3838}:host span.pd-tree-container,regular-table span.pd-tree-container{display:flex;align-items:center;height:100%}:host tbody .pd-date,:host tbody .pd-datetime,:host tbody .pd-string,:host thead .pd-date,:host thead .pd-datetime,:host thead .pd-string,regular-table tbody .pd-date,regular-table tbody .pd-datetime,regular-table tbody .pd-string,regular-table thead .pd-date,regular-table thead .pd-datetime,regular-table thead .pd-string{text-align:left}:host tr td.pd-group-header,:host tr th,regular-table tr td.pd-group-header,regular-table tr th{border-right:1px solid #ddd}:host tr th:last-child,:host tr:last-child th:not(.pd-group-header),regular-table tr th:last-child,regular-table tr:last-child th:not(.pd-group-header){border-right:none}:host tr:last-child th,regular-table tr:last-child th{border-bottom:1px solid #ddd}:host tr td span.pd-tree-group,regular-table tr td span.pd-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}:host td,:host th,regular-table td,regular-table th{white-space:nowrap;font-size:12px;height:19px;padding:0 5px}:host tbody,regular-table tbody{transition:opacity .2s ease-in}:host tbody:hover tr:hover td,regular-table tbody:hover tr:hover td{background:#eee;opacity:1}:host table tr:hover,regular-table table tr:hover{color:#333}:host tr,regular-table tr{transition:background-color .2s ease-in,color .2s ease-in}:host table *,regular-table table *{box-sizing:border-box}:host table,regular-table table{position:absolute;overflow:hidden;color:#666}:host span.pd-row-header-icon,regular-table span.pd-row-header-icon{color:#aaa;padding-right:4px;font-family:"Material Icons"}:host span.pd-column-header-icon,regular-table span.pd-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:"Material Icons"}:host span.pd-row-header-icon:hover,regular-table span.pd-row-header-icon:hover{color:#1a7da1;text-shadow:0 0 3px #1a7da1}:host .pd-selected td,regular-table .pd-selected td{background-color:#eee}:host .pd-cell-clip,regular-table .pd-cell-clip{overflow:hidden;text-overflow:ellipsis}:host td span.pd-group-name,:host th span.pd-group-name,regular-table td span.pd-group-name,regular-table th span.pd-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}:host td span.pd-group-leaf,regular-table td span.pd-group-leaf{margin-left:12px;height:100%}:host .pd-column-resize,regular-table .pd-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}:host::-webkit-scrollbar,regular-table::-webkit-scrollbar{width:8px;height:8px}:host:hover::-webkit-scrollbar-thumb,regular-table:hover::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.3)}:host::-webkit-scrollbar-thumb,regular-table::-webkit-scrollbar-thumb{border-radius:4px;background-color:rgba(0,0,0,0)}:host::-webkit-scrollbar-corner,regular-table::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}',""])},function(t,e,i){"use strict";i.r(e);i(1);var r=i(43),o=(i(72),i(44)),n=i.n(o);function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const a=new WeakMap;class l{static async update(t){try{const e=a.get(t);await e.draw({invalid_viewport:!0})}catch(t){return}}static async create(t,e){const i=function(t,e){let i;return a.has(e)?(i=a.get(e),i.isConnected||(i.clear(),e.innerHTML="",e.appendChild(document.createElement("slot")),t.appendChild(i))):(i=document.createElement("regular-table"),e.innerHTML="",e.appendChild(document.createElement("slot")),t.appendChild(i),a.set(e,i)),i}(this,t),r=await i.set_view(this.table,e);this._plugin_config&&(i.restore(this._plugin_config),delete this._plugin_config),await i.draw(r)}static async resize(){if(this.view&&a.has(this._datavis)){const t=a.get(this._datavis);await t.draw({invalid_viewport:!0})}}static delete(){if(this.view&&a.has(this._datavis)){a.get(this._datavis).clear()}}static save(){if(this.view&&a.has(this._datavis)){return a.get(this._datavis).save()}}static restore(t){if(this.view&&a.has(this._datavis)){a.get(this._datavis).restore(t)}else this._plugin_config=t}}s(l,"name","Datagrid"),s(l,"selectMode","toggle"),s(l,"deselectMode","pivots"),Object(r.a)("datagrid",l),function(){const t=document.createElement("style");t.textContent=n.a,document.head.appendChild(t)}()},function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,e,i){"use strict";var r=i(12),o=i(22),n=i(19),s=i(34),a=i(59),l=s.set,c=s.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,e){l(this,{type:"Array Iterator",target:r(t),index:0,kind:e})}),(function(){var t=c(this),e=t.target,i=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:r,done:!1}:"values"==i?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values"),n.Arguments=n.Array,o("keys"),o("values"),o("entries")},function(t,e,i){var r=i(5),o=i(49),n="".split;t.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?n.call(t,""):Object(t)}:Object},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){var r=i(29);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,i){var r=i(8),o=i(9),n=i(11),s=i(52);t.exports=r?Object.defineProperties:function(t,e){n(t);for(var i,r=s(e),a=r.length,l=0;a>l;)o.f(t,i=r[l++],e[i]);return t}},function(t,e,i){var r=i(31),o=i(17);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e,i){var r=i(12),o=i(54),n=i(55),s=function(t){return function(e,i,s){var a,l=r(e),c=o(l.length),u=n(s,c);if(t&&i!=i){for(;c>u;)if((a=l[u++])!=a)return!0}else for(;c>u;u++)if((t||u in l)&&l[u]===i)return t||u||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},function(t,e,i){var r=i(32),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,i){var r=i(32),o=Math.max,n=Math.min;t.exports=function(t,e){var i=r(t);return i<0?o(i+e,0):n(i,e)}},function(t,e,i){var r=i(33);t.exports=r("document","documentElement")},function(t,e,i){var r=i(0);t.exports=r},function(t,e,i){var r=i(0),o=i(35),n=r.WeakMap;t.exports="function"==typeof n&&/native code/.test(o(n))},function(t,e,i){"use strict";var r=i(60),o=i(67),n=i(39),s=i(70),a=i(40),l=i(4),c=i(37),u=i(7),d=i(13),_=i(19),h=i(38),p=h.IteratorPrototype,f=h.BUGGY_SAFARI_ITERATORS,g=u("iterator"),v=function(){return this};t.exports=function(t,e,i,u,h,m,b){o(i,e,u);var w,y,x,O=function(t){if(t===h&&T)return T;if(!f&&t in z)return z[t];switch(t){case"keys":case"values":case"entries":return function(){return new i(this,t)}}return function(){return new i(this)}},M=e+" Iterator",E=!1,z=t.prototype,j=z[g]||z["@@iterator"]||h&&z[h],T=!f&&j||O(h),A="Array"==e&&z.entries||j;if(A&&(w=n(A.call(new t)),p!==Object.prototype&&w.next&&(d||n(w)===p||(s?s(w,p):"function"!=typeof w[g]&&l(w,g,v)),a(w,M,!0,!0),d&&(_[M]=v))),"values"==h&&j&&"values"!==j.name&&(E=!0,T=function(){return j.call(this)}),d&&!b||z[g]===T||l(z,g,T),_[e]=T,h)if(y={values:O("values"),keys:m?T:O("keys"),entries:O("entries")},b)for(x in y)!f&&!E&&x in z||c(z,x,y[x]);else r({target:e,proto:!0,forced:f||E},y);return y}},function(t,e,i){var r=i(0),o=i(36).f,n=i(4),s=i(37),a=i(14),l=i(62),c=i(66);t.exports=function(t,e){var i,u,d,_,h,p=t.target,f=t.global,g=t.stat;if(i=f?r:g?r[p]||a(p,{}):(r[p]||{}).prototype)for(u in e){if(_=e[u],d=t.noTargetGet?(h=o(i,u))&&h.value:i[u],!c(f?u:p+(g?".":"#")+u,t.forced)&&void 0!==d){if(typeof _==typeof d)continue;l(_,d)}(t.sham||d&&d.sham)&&n(_,"sham",!0),s(i,u,_,t)}}},function(t,e,i){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,n=o&&!r.call({1:2},1);e.f=n?function(t){var e=o(this,t);return!!e&&e.enumerable}:r},function(t,e,i){var r=i(2),o=i(63),n=i(36),s=i(9);t.exports=function(t,e){for(var i=o(e),a=s.f,l=n.f,c=0;c<i.length;c++){var u=i[c];r(t,u)||a(t,u,l(e,u))}}},function(t,e,i){var r=i(33),o=i(64),n=i(65),s=i(11);t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(s(t)),i=n.f;return i?e.concat(i(t)):e}},function(t,e,i){var r=i(31),o=i(17).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var r=i(5),o=/#|\.prototype\./,n=function(t,e){var i=a[s(t)];return i==c||i!=l&&("function"==typeof e?r(e):!!e)},s=n.normalize=function(t){return String(t).replace(o,".").toLowerCase()},a=n.data={},l=n.NATIVE="N",c=n.POLYFILL="P";t.exports=n},function(t,e,i){"use strict";var r=i(38).IteratorPrototype,o=i(30),n=i(15),s=i(40),a=i(19),l=function(){return this};t.exports=function(t,e,i){var c=e+" Iterator";return t.prototype=o(r,{next:n(1,i)}),s(t,c,!1,!0),a[c]=l,t}},function(t,e,i){var r=i(21);t.exports=function(t){return Object(r(t))}},function(t,e,i){var r=i(5);t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,e,i){var r=i(11),o=i(71);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(t){}return function(i,n){return r(i),o(n),e?t.call(i,n):i.__proto__=n,i}}():void 0)},function(t,e,i){var r=i(10);t.exports=function(t){if(!r(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},function(t,e,i){"use strict";var r=i(3),o=i(73);window.customElements.define("regular-table",o.RegularViewModel),(0,r._start_profiling_loop)()},function(t,e,i){"use strict";i(41),Object.defineProperty(e,"__esModule",{value:!0}),e.RegularViewModel=void 0;var r=i(6),o=i(74),n=i(78);class s extends n.RegularViewEventModel{connectedCallback(){this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._column_sizes={auto:{},override:{},indices:[]},this.table_model=new o.RegularTableViewModel(this._table_clip,this._column_sizes,this._sticky_container),this.table_model&&this!==this._sticky_container.parentElement&&this.appendChild(this._sticky_container)}get_meta(t){return r.METADATA_MAP.get(t)}get_tds(){return this.table_model.body.cells.flat(1)}get_ths(){return this.table_model.body.cells.flat(1)}clear(){this._sticky_container.innerHTML="<table></table>"}reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this.reset_viewport()}async set_view(t,e){const i=await e.get_config(),r=await t.schema(),o=await e.schema(),n=await e.column_paths();this._invalid_schema=!0;const s=this.infer_options(i);return this._view_cache={view:e,config:i,column_paths:n,schema:o,table_schema:r},s}save(){const t=this._get_selected();if(void 0!==t)return{selected:t}}restore(t){t.selected&&this._set_selected(t.selected)}}e.RegularViewModel=s},function(t,e,i){"use strict";i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.RegularTableViewModel=void 0;var r=i(75),o=i(77),n=i(3);e.RegularTableViewModel=class{constructor(t,e,i){i.innerHTML=n.html` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `;const[s]=i.children,[a,l]=s.children;this.table=s,this._column_sizes=e,this.header=new r.RegularHeaderViewModel(e,t,a),this.body=new o.RegularBodyViewModel(e,t,l),this.fragment=document.createDocumentFragment()}num_columns(){var t;return this.header._get_row(Math.max(0,(null===(t=this.header.rows)||void 0===t?void 0:t.length)-1||0)).row_container.length}autosize_cells(t){for(;t.length>0;){const[e,i]=t.shift(),r=e.offsetWidth;this._column_sizes.row_height=this._column_sizes.row_height||e.offsetHeight,this._column_sizes.indices[i.cidx]=r;const o=this._column_sizes.override.hasOwnProperty(i.size_key);r&&!o&&(this._column_sizes.auto[i.size_key]=r)}}async draw(t,e,i,r,o){const{width:s,height:a}=t,{view:l,config:c,column_paths:u,schema:d,table_schema:_}=e,h=u.slice(o.start_col),p=await l.to_columns(o),{start_row:f=0,start_col:g=0}=o,v=c.row_pivots.length,m=p.__ID__,b={viewport_width:0,selected_id:i,depth:v,ridx_offset:f,cidx_offset:g,row_height:this._column_sizes.row_height};let w,y=0,x=[],O=!0;if("__ROW_PATH__"===u[0]){var M;const t=c.row_pivots.join(","),e=c.row_pivots.map(t=>_[t]),i={column_name:t,cidx:0,column_data:p.__ROW_PATH__,id_column:m,type:e,first_col:O},o=this.header.draw(c,t,"",e,0);w=this.body.draw(a,i,{...b,cidx_offset:0}),O=!1,b.viewport_width+=this._column_sizes.indices[0]||(null===(M=w.td)||void 0===M?void 0:M.offsetWidth)||o.th.offsetWidth,b.row_height=b.row_height||w.row_height,y++,r||x.push([w.td||o.th,w.metadata||o.metadata])}try{for(;y<h.length;){var E;const t=h[y];if(!p[t]){let e=Math.max(o.end_col,0);o.start_col=e,o.end_col=e+1;const i=await l.to_columns(o);t in i||(i[t]=[]),p[t]=i[t]}const e=(0,n.column_path_2_type)(d,t),i={column_name:t,cidx:y,column_data:p[t],id_column:m,type:e,first_col:O},u=this.header.draw(c,void 0,t,e,y+g);if(w=this.body.draw(a,i,b),O=!1,b.viewport_width+=this._column_sizes.indices[y+g]||(null===(E=w.td)||void 0===E?void 0:E.offsetWidth)||u.th.offsetWidth,b.row_height=b.row_height||w.row_height,y++,r||x.push([w.td||u.th,w.metadata||u.metadata]),b.viewport_width>s)break}return x}finally{var z;this.body.clean({ridx:(null===(z=w)||void 0===z?void 0:z.ridx)||0,cidx:y}),this.header.clean()}}}},function(t,e,i){"use strict";i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.RegularHeaderViewModel=void 0;var r=i(42),o=i(6),n=i(3);function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class a extends r.ViewModel{constructor(...t){super(...t),s(this,"_group_header_cache",[]),s(this,"_offset_cache",[])}_draw_group_th(t,e,i,r){const{tr:s,row_container:a}=this._get_row(e),l=this._get_cell("th",a,t[e],s);if(t[e]+=1,l.className="",l.removeAttribute("colspan"),l.style.minWidth="0",0===(null==r?void 0:r.length))l.innerHTML=n.html` <span>${i}</span> <span class="pd-column-resize"></span> `;else{const t=null==r?void 0:r.map(t=>{const e=o.ICON_MAP[t];return n.html` <span class="pd-column-header-icon">${e}</span> `}).join("");l.innerHTML=n.html` <span>${i}</span> ${t} <span class="pd-column-resize"></span> `}return l}_redraw_previous(t,e){const{tr:i,row_container:r}=this._get_row(e),o=t[e]-1;if(o<0)return;const n=this._get_cell("th",r,o,i);return n?(n.classList.add("pd-group-header"),n):void 0}_draw_group(t,e,i,r){const o=this._get_or_create_metadata(r);return o.column_path=t,o.column_name=e,o.column_type=i,o.is_column_header=!1,r.className="",o}_draw_th(t,e,i,r){const o=this._get_or_create_metadata(r);o.column_path=t,o.column_name=e,o.column_type=i,o.is_column_header=!0,o.size_key=`${t}|${i}`;const n=this._column_sizes.auto[o.size_key],s=this._column_sizes.override[o.size_key];return r.classList.add(`pd-${i}`),s?(r.classList.toggle("pd-cell-clip",n>s),r.style.minWidth=s+"px",r.style.maxWidth=s+"px"):n&&(r.classList.remove("pd-cell-clip"),r.style.maxWidth="",r.style.minWidth=n+"px"),o}get_column_header(t){const{tr:e,row_container:i}=this._get_row(this.rows.length-1);return this._get_cell("th",i,t,e)}draw(t,e,i,r,o){var n;const s=t.column_pivots.length+1;let a,l,c=null===(n=i.split)||void 0===n?void 0:n.call(i,"|"),u=!1;for(let n=0;n<s;n++)if(l=c[n]?c[n]:"",this._offset_cache[n]=this._offset_cache[n]||0,n<s-1){var d,_,h;if((null===(d=this._group_header_cache)||void 0===d?void 0:null===(_=d[n])||void 0===_?void 0:null===(h=_[0])||void 0===h?void 0:h.column_name)===l)a=this._group_header_cache[n][1],this._group_header_cache[n][2]+=1,a.setAttribute("colspan",this._group_header_cache[n][2]);else{a=this._draw_group_th(this._offset_cache,n,l,[]);const t=this._draw_group(i,l,r,a);this._group_header_cache[n]=[t,a,1],u=!0}}else{var p;u&&this._redraw_previous(this._offset_cache,n);const s=this._offset_cache[n],c=null===(p=t.sort)||void 0===p?void 0:p.filter(t=>t[0]===l).map(t=>t[1]);a=this._draw_group_th(this._offset_cache,n,l,c);const d=this._draw_th(e||i,l,r,a);d.vcidx=s,d.cidx=o;for(const[t]of this._group_header_cache)t.cidx=o,t.vcidx=s,t.size_key=d.size_key}1===s&&Array.isArray(r)&&a.classList.add("pd-group-header");const f=this._get_or_create_metadata(a);return this._clean_rows(this._offset_cache.length),{th:a,metadata:f}}clean(){this._clean_columns(this._offset_cache),this._offset_cache=[],this._group_header_cache=[]}}e.RegularHeaderViewModel=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tree_header=function(t,e,i,n,s){const a=i[e.length-1],l=0===e.length?"TOTAL":e[e.length-1],c=o.call(this,l,a,n),u=function(t,e,i){const r=t.map(()=>'<span class="pd-tree-group"></span>');if(!i){const t=`<span class="pd-row-header-icon">${e?"remove":"add"}</span>`;r.push(t)}return r.join("")}(e,s,n),d=this._format_text(a)(l);t.classList.add("pd-group-header"),t.innerHTML=r.html` <span class="pd-tree-container"> ${u} <span class="${c}">${d}</span> </span> `};var r=i(3);function o(t,e,i){const r=this._format_class(e)(t),o=["pd-group-name"];return i&&o.push("pd-group-leaf"),r&&o.push(r),o.join(" ")}},function(t,e,i){"use strict";i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.RegularBodyViewModel=void 0;var r=i(3),o=i(42);class n extends o.ViewModel{_draw_td(t,e,i,o,{cidx:n,column_name:s,type:a,first_col:l},{selected_id:c,depth:u,ridx_offset:d,cidx_offset:_}){const{tr:h,row_container:p}=this._get_row(t),f=this._get_cell("td",p,n,h);if(f.className=`pd-${a}`,l&&void 0!==c){const t=(0,r.isEqual)(i,c),e=!t&&(0,r.isEqual)(null==i?void 0:i.slice(0,null==c?void 0:c.length),c);h.classList.toggle("pd-selected",!!i&&t),h.classList.toggle("pd-sub-selected",!!i&&e)}const g=this._get_or_create_metadata(f);g.id=i,g.cidx=n+_,g.type=a,g.column=s,g.size_key=`${s}|${a}`,g.ridx=t+d;const v=this._column_sizes.override[g.size_key];if(v){const t=this._column_sizes.auto[g.size_key];f.classList.toggle("pd-cell-clip",t>v),f.style.minWidth=v+"px",f.style.maxWidth=v+"px"}else f.classList.remove("pd-cell-clip"),f.style.minWidth="",f.style.maxWidth="";const m=this._format(a);return null==e?(f.textContent="-",g.value=null,g.row_path=null):m?(m.format(f,e,a,e.length===u,o),g.value=Array.isArray(e)?e[e.length-1]:e,g.row_path=i,g.is_open=o):(f.textContent=e,g.value=e),{td:f,metadata:g}}draw(t,e,i){const{cidx:r,column_data:o,id_column:n}=e;let s,a,{row_height:l}=i,c=0;for(const r of o){const u=o[c+1],d=null==n?void 0:n[c],_=this._draw_td(c++,r,d,(null==u?void 0:u.length)>(null==r?void 0:r.length),e,i);if(s=_.td,a=_.metadata,l=l||s.offsetHeight,c*l>t)break}return this._clean_rows(c),{td:s,cidx:r,ridx:c,metadata:a,row_height:l}}clean({ridx:t,cidx:e}){this._clean_rows(t),this._clean_columns(e)}}e.RegularBodyViewModel=n},function(t,e,i){"use strict";i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.RegularViewEventModel=void 0;var r,o=i(6),n=i(79),s=i(3);let a=(r=class extends n.RegularVirtualTableViewModel{register_listeners(){this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!1}),this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!1}),this.addEventListener("mousedown",this._on_click.bind(this)),this.addEventListener("dblclick",this._on_dblclick.bind(this))}async _on_scroll(t){t.stopPropagation(),t.returnValue=!1,await this.draw(),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_on_mousewheel(t){if(this._virtual_scrolling_disabled)return;t.preventDefault(),t.returnValue=!1;const{offsetWidth:e,offsetHeight:i,scrollTop:r,scrollLeft:o}=this,n=Math.max(1,this._virtual_panel.offsetHeight-i),s=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.min(n,r+t.deltaY),this.scrollLeft=Math.min(s,o+t.deltaX),this._on_scroll(t)}async _on_dblclick(t){let e=t.target;for(;"TD"!==e.tagName&&"TH"!==e.tagName;)if(e=e.parentElement,!this._sticky_container.contains(e))return;const i=t.target.classList.contains("pd-column-resize"),r=o.METADATA_MAP.get(e);if(i){await new Promise(setTimeout),delete this._column_sizes.override[r.size_key],delete this._column_sizes.auto[r.size_key],delete this._column_sizes.indices[r.cidx],e.style.minWidth="",e.style.maxWidth="";for(const t of this.table_model.body.cells){const e=t[r.cidx];e.style.minWidth="",e.style.maxWidth="",e.classList.remove("pd-cell-clip")}await this.draw({invalid_viewport:!0})}}async _on_click(t){if(0!==t.button)return;let e=t.target;for(;"TD"!==e.tagName&&"TH"!==e.tagName;)if(e=e.parentElement,!this._sticky_container.contains(e))return;const i=t.target.classList.contains("pd-row-header-icon"),r=t.target.classList.contains("pd-column-resize"),n=o.METADATA_MAP.get(e);i?await this._on_toggle(t,n):r?this._on_resize_column(t,e,n):(null==n?void 0:n.is_column_header)?await this._on_sort(t,n):this.parentElement.hasAttribute("selectable")&&await this._on_row_select(n)}_on_resize_column(t,e,i){const r=t.pageX;e=this.table_model.header.get_column_header(i.vcidx);const o=this._column_sizes.indices[i.cidx],n=t=>this._on_resize_column_move(t,e,r,o,i),s=async()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",s);const t=this._column_sizes.override[i.size_key];this._column_sizes.indices[i.cidx]=t,await this.draw({invalid_viewport:!0})};document.addEventListener("mousemove",n),document.addEventListener("mouseup",s)}async _on_resize_column_move(t,e,i,r,o){await new Promise(setTimeout);const n=t.pageX-i,s=r+n;if(this._column_sizes.override[o.size_key]=s,n<0)await this.draw({invalid_viewport:!0,preserve_width:!0});else{e.style.minWidth=s+"px",e.style.maxWidth=s+"px";const t=this._column_sizes.auto[o.size_key];for(const e of this.table_model.body.cells){const i=e[o.vcidx];i.style.maxWidth=i.style.minWidth=s+"px",i.classList.toggle("pd-cell-clip",t>s)}}}_get_selected(){return this._selected_id}_set_selected(t){this._selected_id=t}_clear_selected(){delete this._selected_id}async _on_row_select(t){const e=(0,s.isEqual)(t.id,this._selected_id);let i=[];e?(this._clear_selected(),await this.draw({invalid_viewport:!0})):(this._set_selected(t.id),await this.draw({invalid_viewport:!0}),i=await(0,s.getCellConfig)(this._view_cache,t.ridx,t.cidx),i=i.config.filters),this.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:!e,config:{filters:i}}}))}async _on_toggle(t,e){e.is_open?t.shiftKey?await this._view_cache.view.set_depth(e.row_path.length-1):await this._view_cache.view.collapse(e.ridx):!1===e.is_open&&(t.shiftKey?await this._view_cache.view.set_depth(e.row_path.length):await this._view_cache.view.expand(e.ridx)),await this.draw({invalid_viewport:!0})}async _on_sort(t,e){let i=this._view_cache.config.sort.slice();const r=i.findIndex(t=>t[0]===e.column_name);if(r>-1){const o=i[r][1],n=this.parentElement._increment_sort(o,!1,t.altKey);i[r]=[e.column_name,n]}else{let r=t.altKey?"asc abs":"asc";const o=[e.column_name,r];t.shiftKey?i.push(o):i=[o]}this.parentElement.setAttribute("sort",JSON.stringify(i))}},l=r.prototype,c="_on_resize_column_move",u=[s.throttlePromise],d=Object.getOwnPropertyDescriptor(r.prototype,"_on_resize_column_move"),_=r.prototype,h={},Object.keys(d).forEach((function(t){h[t]=d[t]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=u.slice().reverse().reduce((function(t,e){return e(l,c,t)||t}),h),_&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(_):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(l,c,h),h=null),r);var l,c,u,d,_,h;e.RegularViewEventModel=a},function(t,e,i){"use strict";i(1),Object.defineProperty(e,"__esModule",{value:!0}),e.RegularVirtualTableViewModel=void 0;var r,o=i(3),n=i(6);function s(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(s.prototype,HTMLElement.prototype),Object.setPrototypeOf(s,HTMLElement);let a=(l=(r=class extends s{create_shadow_dom(){this.attachShadow({mode:"open"});const t="<slot></slot>",e=o.css`/******************************************************************************
 *
 * Copyright (c) 2020, the Regular Table Authors.
 *
 * This file is part of the Regular Table library, distributed under the terms
 * of the Apache License 2.0.  The full license can be found in the LICENSE
 * file.
 *
 */

:host {
    position:absolute;
    top: 0px;
    left: 0px;
    right: 0px;
    bottom: 0px;
    overflow: overlay;
    -webkit-overflow-scrolling: auto;
}

div.pd-virtual-panel {
    position:absolute;
    top:0;
    left:0;
    right:0;
    pointer-events:none;
}

div.pd-scroll-table-clip {
    position:sticky;
    position:-webkit-sticky;
    top:0;
    left:0;
    overflow:hidden;
    width:100%;
    height:100%
}

div.pd-tree-container {
    display:flex;
    align-items:center;
    height:100%;
}

slot {
    position:absolute;
    overflow:hidden;
}`;this.shadowRoot.innerHTML=o.html` <style> ${e} </style> <div class="pd-virtual-panel"> ${this._virtual_scrolling_disabled?t:""} </div> <div class="pd-scroll-table-clip"> ${this._virtual_scrolling_disabled?"":t} </div> <div style="position: absolute; visibility: hidden;"></div> `;const i=document.createElement("div");i.setAttribute("tabindex","0");const[,r,n,s]=this.shadowRoot.children;this._sticky_container=i,this._table_clip=n,this._table_staging=s,this._virtual_panel=r}_calculate_viewport(t,e){const i=this._view_cache.config.row_pivots.length>0;if(this._virtual_scrolling_disabled)return{id:i};const{start_row:r,end_row:o}=this._calculate_row_range(t,e),{start_col:n,end_col:s}=this._calculate_column_range();return this._nrows=t,{start_col:n,end_col:s,start_row:r,end_row:o,id:i}}_calculate_row_range(t,e){const{height:i}=this._container_size,r=this._column_sizes.row_height||19,o=this._view_cache.config.column_pivots.length+1,n=Math.max(1,this._virtual_panel.offsetHeight-this.offsetHeight),s=this.scrollTop/n,a=i/r,l=e?t:this._nrows||0,c=Math.max(0,l+(o-a));let u=Math.ceil(c*s);return{start_row:u,end_row:u+a+1}}_calculate_column_range(){const t=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),e=this.scrollLeft/t,i=this._max_scroll_column()+.5;let r=Math.floor(i*e);return{start_col:r,end_col:r+(this.table_model.num_columns()||1)+1}}_max_scroll_column(){let t=0;this._view_cache.config.row_pivots.length>0&&(t=this._column_sizes.indices[0]);let e=this._view_cache.column_paths.length;for(;t<this._container_size.width&&e>=0;)e--,t+=this._column_sizes.indices[e]||60;const i=this._view_cache.config.row_pivots.length>0;return Math.min(this._view_cache.column_paths.length-(i?2:1),e+(i?0:1))}_validate_viewport({start_col:t,end_col:e,start_row:i,end_row:r}){const o=this._start_col!==t,n=this._start_row!==i||this._end_row!==r||this._end_col!==e;return this._start_col=t,this._end_col=e,this._start_row=i,this._end_row=r,{invalid_column:o,invalid_row:n}}_needs_swap({invalid_row:t,invalid_column:e}){return n.DOUBLE_BUFFER_RECREATE&&this._invalid_schema||n.DOUBLE_BUFFER_COLUMN&&(e||this._invalid_schema)||n.DOUBLE_BUFFER_ROW&&(t||this._invalid_schema)}_swap_in(t){this.dispatchEvent(new CustomEvent("regular-table-before-update",{bubbles:!0,detail:this})),this._virtual_scrolling_disabled||(this._needs_swap(t)?(this._sticky_container===this.table_model.table.parentElement&&this._sticky_container.replaceChild(this.table_model.table.cloneNode(!0),this.table_model.table),this._table_staging.appendChild(this.table_model.table)):this._sticky_container!==this.table_model.table.parentElement&&this._sticky_container.replaceChild(this.table_model.table,this._sticky_container.children[0]))}_swap_out(t){!this._virtual_scrolling_disabled&&this._needs_swap(t)&&this._sticky_container.replaceChild(this.table_model.table,this._sticky_container.children[0]),this.dispatchEvent(new CustomEvent("regular-table-after-update",{bubbles:!0,detail:this}))}_update_virtual_panel_width(t){if(t)if(this._virtual_scrolling_disabled)this._virtual_panel.style.width=this._column_sizes.indices.reduce((t,e)=>t+e,0)+"px";else{const t=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),e=this.scrollLeft/t,i=this._max_scroll_column();let r=0,o=0;for(;r<i;)o+=this._column_sizes.indices[r]||60,r++;const n=this._container_size.width+o;this._virtual_panel.style.width=n+"px",this.scrollLeft=e*o}}_update_virtual_panel_height(t){const{row_height:e=19}=this._column_sizes,i=this.table_model.header.cells.length*e;let r;if(this._virtual_scrolling_disabled)r=t*e+i;else{const{height:o}=this._container_size,s=this.offsetHeight/(o-i);r=Math.min(n.BROWSER_MAX_HEIGHT,t*e*s)}this._virtual_panel.style.height=`${r}px`}infer_options(t){if(t=Object.assign({},t),!this._view_cache)return{};const e=Object.assign({},this._view_cache.config);return delete e.sort,delete t.sort,{reset_scroll_position:!(0,o.isEqual)(t,e)}}async draw(t={}){const e=n.DEBUG&&performance.now(),{reset_scroll_position:i=!1,preserve_width:r=!1,invalid_viewport:s=!1}=t;if(void 0===this._view_cache.column_paths)return;i&&this.reset_scroll();const a=await this._view_cache.view.num_rows();this._virtual_scrolling_disabled?this._container_size={width:1/0,height:1/0}:this._container_size=!this._invalid_schema&&!s&&this._container_size||{width:this._table_clip.offsetWidth,height:this._table_clip.offsetHeight};const l=this._calculate_viewport(a,i),c=this._validate_viewport(l),{invalid_row:u,invalid_column:d}=c;if(this._update_virtual_panel_height(a),this._invalid_schema||u||d||s){this._swap_in(c);const t=await this.table_model.draw(this._container_size,this._view_cache,this._selected_id,r,l);this._swap_out(c),this.table_model.autosize_cells(t),r||this._update_virtual_panel_width(this._invalid_schema||d||s),this._invalid_schema=!1}n.DEBUG&&(0,o.log_perf)(performance.now()-e)}}).prototype,c="draw",u=[o.throttlePromise],d=Object.getOwnPropertyDescriptor(r.prototype,"draw"),_=r.prototype,h={},Object.keys(d).forEach((function(t){h[t]=d[t]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=u.slice().reverse().reduce((function(t,e){return e(l,c,t)||t}),h),_&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(_):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(l,c,h),h=null),r);var l,c,u,d,_,h;e.RegularVirtualTableViewModel=a},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",r=t[3];if(!r)return i;if(e&&"function"==typeof btoa){var o=(s=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),n=r.sources.map((function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"}));return[i].concat(n).concat([o]).join("\n")}var s;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},o=0;o<this.length;o++){var n=this[o][0];"number"==typeof n&&(r[n]=!0)}for(o=0;o<t.length;o++){var s=t[o];"number"==typeof s[0]&&r[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),e.push(s))}},e}}])}));
//# sourceMappingURL=perspective-viewer-datagrid.js.map